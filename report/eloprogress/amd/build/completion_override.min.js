define(["jquery","core/ajax","core/str","core/modal_factory","core/modal_events","core/notification","core/custom_interaction_events","core/templates"],function(e,t,n,o,r,i,c,a){var l,p,s=function(c,s){s.originalEvent.preventDefault(),s.originalEvent.stopPropagation(),c.preventDefault(),c.stopPropagation();var m=(p=e(c.currentTarget)).data("changecompl").split("-"),d={userid:m[0],cmid:m[1],newstate:m[2]},u=1==d.newstate?"completion-y":"completion-n";n.get_strings([{key:u,component:"completion"}]).then(function(e){return n.get_strings([{key:"confirm",component:"moodle"},{key:"areyousureoverridecompletion",component:"completion",param:e[0]}])}).then(function(e){return o.create({type:o.types.CONFIRM,title:e[0],body:e[1]})}).then(function(e){e.getRoot().on(r.yes,function(){!function(e){a.render("core/loading",{}).then(function(n){return p.append(n),t.call([{methodname:"core_completion_override_activity_completion_status",args:e}])[0]}).then(function(t){var o=t.state>0?1:0,r=o?"completion-y-override":"completion-n-override";n.get_string(r,"completion",l).then(function(e){var t={state:e,date:"",user:p.attr("data-userfullname"),activity:p.attr("data-activityname")};return n.get_string("eloprogress-title","report_eloprogress",t)}).then(function(e){var t,n=p.attr("data-completiontracking");return a.renderPix((t=n,o>0?"i/completion-"+t+"-y-override":"i/completion-"+t+"-n-override"),"core",e)}).then(function(t){var n=o>0?0:1;p.find(".loading-icon").remove(),p.data("changecompl",e.userid+"-"+e.cmid+"-"+n),p.attr("data-changecompl",e.userid+"-"+e.cmid+"-"+n),p.children("img").replaceWith(t)}).catch(i.exception)}).catch(i.exception)}(d)}),e.getRoot().on(r.hidden,function(){p.focus(),e.destroy()}),e.show()}).catch(i.exception)};return{init:function(t){l=t,e("#completion-eloprogress-dttable a.changecompl").each(function(e,t){c.define(t,[c.events.activate])}),e("#completion-eloprogress-dttable").on(c.events.activate,"a.changecompl",function(e,t){s(e,t)})}}});